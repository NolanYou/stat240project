---
title: "Coronary Heart Disease and Stroke Draft"
output: html_document
date: "2022-11-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
library(tidyverse)
library(lubridate)
library(readxl)
library(broman)
library(usmap)
source("../scripts/viridis.R")
source("../scripts/ggprob.R")
```

```{r, include = FALSE}
all_data = read_csv("data.csv")
```


```{r, include = FALSE}
##Cleaning Data
data = all_data %>% 
  select(Year,LocationAbbr, LocationDesc, Topic, Data_Value, Stratification1, Stratification2, Stratification3) %>% 
  rename(year = Year, state = LocationAbbr, county = LocationDesc, age_group = Stratification1, data = Data_Value, type = Topic, race = Stratification2, sex = Stratification3) %>% 
  filter(!is.na(data)) %>% 
  arrange(year) %>% 
  mutate( type = recode(type, "Coronary heart disease (CHD)" = "CHD", "All stroke" = "Stroke"))

```


## Introduction

Some of the leading causes of death in the United States are strokes and heart diseases. Medical data analysis is necessary to study in order to figure out how to better treat patients, which is necessary to save lives. In this project we are analyzing a collection of data about heart disease and stroke deaths in order to analyze roots and causes. This data is sourced directly from the CDC, which in turn is sourced by state governments. Through this analysis we will examine factors including sex, age, race, and state location in order to evaluate how they affect the prevalence of strokes and heart diseases.


## Background

Coronary heart disease is the leading cause of death in the United States for both men and women of all racial and ethnic groups, and a stroke occurs every 40 seconds^[https://www.cdc.gov/stroke/facts.htm#:~:text=Stroke%20statistics,-In%202020%2C%201&text=Every%2040%20seconds%2C%20someone%20in,minutes%2C%20someone%20dies%20of%20stroke.&text=Every%20year%2C%20more%20than%20795%2C000,are%20first%20or%20new%20strokes.]. As a result, analyzing cardiovascular disease is common for many Americans and can affect anyone. Many organizations study and research both the effects and the causes in order to prevent the impact on society from continuing, but there is a general lack of funding for many health research facilities. The Division for Heart Disease and Stroke Prevention, Million Hearts, and WISEWOMEN are a few of these organizations^[https://www.cdc.gov/heartdisease/about.htm].

Cardiovascular disease encompasses a wide range of heart conditions such as coronary artery disease, heart attack, arrhythmia, heart failure, high blood pressure, and others. Many of the symptoms of heart disease are not noticed by the patient until a major event occurs. Diabetes, obesity, an unhealthy diet, and lack of physical activity all increase one's risk of heart disease, but it can also be inherited^[https://www.cdc.gov/heartdisease/facts.htm].


Our project will use the provided data to examine the relationships between stroke and coronary heart disease, as well as patient characteristics and geographic location. This data set was collected by the National Vital Statistics System, a division of the Centers for Disease Control and Prevention, and can be found directly on the [CDC website](https://chronicdata.cdc.gov/Heart-Disease-Stroke-Prevention/Rates-and-Trends-in-Heart-Disease-and-Stroke-Morta/7b9s-s8ck). This Federal Government agency obtains its information from state medical records. The data set includes population estimates of stroke and coronary heart disease mortality rates from 1999 to 2019. The data set used a Bayesian spatiotemporal model that was smoothed over time, space, and age group to collect death rate trends.


There are over 5 million rows and 21 columns in the raw data set, but we will be using 677,490 of the given rows, eliminating the rows that contained missing information for the data value column and also only selecting the deaths caused by coronary heart disease or stroke. We will be interested in eight variables, six of which are categorical and two of which are numerical and contain the estimated death rate value and the year data was collected. The four categorical variables are State, County, cardiovascular disease, age range, race, and gender. The state and county will be used to determine the geographical dependencies of the data values, as well as which counties have a higher prevalence. The age range indicates where the data was collected from females and males aged 35 to 64, as well as those aged 65 and older. There are also two categorical variables that contain the data's race and gender. The numeric value represents the death rate per 100,000 people from heart disease, stroke, or heart failure, as specified by the Topic column.

After completing the preliminary research on CHD and stroke, we will analyzing the data set containing mortality rates of these two cause of deaths among the population and answer the following two research questions:
RQ #1: Does age, race, and gender influence stroke and heart disease mortality?
RQ #2: Does geographical location influences the prevalence of these cardiovascular diseases?



## Analysis
### Age

In order to answer RQ1, we will first discuss the influence age has on the mortality rate. The two age groups obtained from the data set are those aged from 35 - 64 and those aged 65 and older. After filtering the data to obtain only the age influenced rows^[```{r, warning = FALSE, echo = FALSE}
# age_data= data %>% 
#   filter(type != "Heart failure" & type != 	"Cardiovascular disease (CVD)" & type != "All heart disease") %>% 
#   filter(race == "Overall", (sex == "Overall")) %>% 
#   select(year, state, county, type, data, age_group)
# age_data
# 
# age_sum = age_data %>% 
#   group_by(age_group, year, type) %>% 
#   mutate(c = n(),
#          n = c*100000,
#     total = sum(data)) %>% 
#   distinct(total, c,n) %>% 
#   mutate(p = total/n) 
# 
# pivot_age = age_sum %>% pivot_wider(names_from = type, values_from = c(c, total, n, p)) %>% rename(
#   n_heart = "n_CHD", 
#   p_heart = "p_CHD", 
#   p_stroke = "p_Stroke", 
#   n_stroke = "n_Stroke",
#   c_stroke = "c_Stroke", 
#   c_heart = "c_CHD",
#   total_stroke = "total_Stroke", 
#   total_heart = "total_CHD"
# )
```], we conduct the following hypothesis test testing whether the average mortality rate are the same between the two age groups or if they do not equal each other. We test the hypothesis for each cause of death separately to control the influence on death.

```{r, include = FALSE, warning = FALSE, echo = FALSE}
age_data= data %>% 
  filter(type != "Heart failure" & type != 	"Cardiovascular disease (CVD)" & type != "All heart disease") %>% 
  filter(race == "Overall", (sex == "Overall")) %>% 
  select(year, state, county, type, data, age_group)
age_data

age_sum = age_data %>% 
  group_by(age_group, year, type) %>% 
  mutate(c = n(),
         n = c*100000,
    total = sum(data)) %>% 
  distinct(total, c,n) %>% 
  mutate(p = total/n) 

pivot_age = age_sum %>% pivot_wider(names_from = type, values_from = c(c, total, n, p)) %>% rename(
  n_heart = "n_CHD", 
  p_heart = "p_CHD", 
  p_stroke = "p_Stroke", 
  n_stroke = "n_Stroke",
  c_stroke = "c_Stroke", 
  c_heart = "c_CHD",
  total_stroke = "total_Stroke", 
  total_heart = "total_CHD"
)
```

```{r, warning = FALSE, echo = FALSE}
ggplot(age_sum, aes(x = year, y = p, color = type, scale= TRUE))+
  geom_point()+
  geom_smooth(se= FALSE)+
  facet_wrap(~age_group)+
  theme_bw()+
  ggtitle("Scatter Plot of Mortality Rate by Age", subtitle = "grouped by Cardiovascular type")+
  ylab("Mortality Proportion of Population")+
  xlab("Year")

```
**Coronary Heart Disease Hypothesis Tests:**

- We will assume that there is a universal parameters $\mu_{\text{35-64}}$ and $\mu_{\text{65+}}$  representing the mean of mortality due to coronary heart disease  per year under the experimental conditions aged 35 - 64 and those aged 65 and older, respectively. 
- Assume the distribution of the mean of mortality due to coronary heart disease is approximately normal (We are interested in the sampling distribution of the sample)
- Assume that all trials are independent.

Model:

$X_i \sim F_1(\mu_{\text{35-64}}, \sigma_{\text{35-64}}), \quad i = 1, \ldots, n_1$    
$Y_i \sim F_2(\mu_{\text{65+}}, \sigma_{\text{65+}}), \quad i = 1, \ldots, n_2$   

Hypotheses:

$H_0: \mu_{\text{35-64}} = \mu_{\text{65+}}$    
$H_a: \mu_{\text{35-64}} \neq \mu_{\text{65+}}$

Test statistic:

$t = \frac{\bar{x} - \bar{y}}{\text{SE}(\bar{x} - \bar{y})}$

```{r, warning = FALSE, echo = FALSE}

x = age_data %>% filter(type == "CHD" & age_group == "Ages 35-64 years") %>% pull(data)
y = age_data %>% filter(type == "CHD" & age_group != "Ages 35-64 years") %>% pull(data)
age_chd_test = t.test(x, y)
age_chd_test
```
There is very strong evidence that the mean mortality rate of those aged 35 to 64 who died from coronary heart disease is smaller than the mean of the mortality rate of those aged 65 and older from heart disease ($p = 2.2e-16$, two-sided t-test, unequal variances).


**Stroke Hypothesis Tests:**

- We will assume that there is a universal parameters $\mu_{\text{35-64}}$ and $\mu_{\text{65+}}$  representing the mean of mortality due to stroke per year under the experimental conditions aged 35 - 64 and those aged 65 and older, respectively. 
- Assume the distribution of the mean of mortality due to stroke is approximately normal (We are interested in the sampling distribution of the sample)
- Assume that all trials are independent.

Model:

$X_i \sim F_1(\mu_{\text{35-64}}, \sigma_{\text{35-64}}), \quad i = 1, \ldots, n_1$    
$Y_i \sim F_2(\mu_{\text{65+}}, \sigma_{\text{65+}}), \quad i = 1, \ldots, n_2$   

Hypotheses:

$H_0: \mu_{\text{35-64}} = \mu_{\text{65+}}$    
$H_a: \mu_{\text{35-64}} \neq \mu_{\text{65+}}$

Test statistic

$t = \frac{\bar{x} - \bar{y}}{\text{SE}(\bar{x} - \bar{y})}$

```{r, warning = FALSE, echo = FALSE}

x = age_data %>% filter(type == "Stroke" & age_group == "Ages 35-64 years") %>% pull(data)
xy = age_data %>% filter(type == "Stroke" & age_group != "Ages 35-64 years") %>% pull(data)
age_stroke_test = t.test(x, y)
age_stroke_test
```
There is very strong evidence that the mean mortality rate of those aged 35 to 64 who died from stroke is smaller than the mean of the mortality rate of those aged 65 and older from heart disease ($p = 2.2e-16$, two-sided t-test, unequal variances).

**Age Influence on Heart Disease vs. Stroke:**

We will now compare the difference in mortality rate per 100,000 population between the two deaths. Through the graph, it is shown that the average mortality rate for CHD is higher among those aged 65 and older compared to those who died from stroke. The average is comparable for the people aged 35 to 64, though. 

```{r, warning = FALSE, echo = FALSE}
ggplot(age_data, aes(y = data, x = type,  fill = age_group)) +
  geom_boxplot()+
  ggtitle("CHD and Stroke Mortality Rate by Age Boxplot")+
  xlab("Cause of Death")+
  ylab("Mortality per 100,000 population")
```


### Sex

We will also look at the influence sex has on each cause of death and their corresponding mortality rate to asnwer RQ1. The data was filtered to obtain only the sex influenced rows^[```{r, echo = FALSE, warning = FALSE}
# sex_data= data %>% 
#   filter(type != "Heart failure" & type != 	"Cardiovascular disease (CVD)" & type != "All heart disease", race == "Overall", sex != "Overall") %>% 
#   select(!race)
# sex_data
# 
# sex_sum = sex_data %>% 
#   group_by(sex, year, type) %>% 
#   mutate(c = n(),
#          n = c*100000,
#     total = sum(data)) %>% 
#   distinct(total, c,n) %>% 
#   mutate(p = total/n)
```], we conduct the following hypothesis test testing whether the average mortality rate are the same between the two sexes (male and female) or if they do not equal each other. We test the hypothesis for each cause of death separately to control the influence on death.

```{r, include = FALSE, warning = FALSE}
sex_data= data %>% 
  filter(type != "Heart failure" & type != 	"Cardiovascular disease (CVD)" & type != "All heart disease", race == "Overall", sex != "Overall") %>% 
  select(!race)
sex_data

sex_sum = sex_data %>% 
  group_by(sex, year, type) %>% 
  mutate(c = n(),
         n = c*100000,
    total = sum(data)) %>% 
  distinct(total, c,n) %>% 
  mutate(p = total/n)
```

```{r, warning = FALSE, echo = FALSE}
ggplot(sex_sum, aes(x = year, y = p, color = type, scale= TRUE))+
  geom_point()+
  geom_smooth(se= FALSE)+
  facet_wrap(~sex)+
  theme_bw()+
  ggtitle("Scatter Plot of Mortality Rate by Sex", subtitle = "grouped by Cardiovascular type")+
   ylab("Mortality Proportion of Population")+
  xlab("Year")
```


**Coronary Heart Disease Hypothesis Tests:**

- We will assume that there is a universal parameters $\mu_{\text{female}}$ and $\mu_{\text{male}}$  representing the mean of female and male mortality due to coronary heart disease per year, respectively. 
- Assume that all trials are independent.

Model:

$X_i \sim F_1(\mu_{\text{female}}, \sigma_{\text{female}}), \quad i = 1, \ldots, n_1$    
$Y_i \sim F_2(\mu_{\text{male}}, \sigma_{\text{male}}), \quad i = 1, \ldots, n_2$   

Hypotheses:

$H_0: \mu_{\text{female}} = \mu_{\text{male}}$    
$H_a: \mu_{\text{female}} \neq \mu_{\text{male}}$

Test statistic:

$t = \frac{\bar{x} - \bar{y}}{\text{SE}(\bar{x} - \bar{y})}$

```{r, warning = FALSE, echo = FALSE}

x = sex_data %>% filter(type == "CHD" & sex == "Women") %>% pull(data)
y = sex_data %>% filter(type == "CHD" & sex == "Men") %>% pull(data)
sex_chd_test = t.test(x, y)
sex_chd_test
```
There is very strong evidence that the mean mortality rate of women who died from coronary heart disease is smaller than the mean of the mortality rate of men from heart disease ($p = 2.2e-16$, two-sided t-test, unequal variances, extreme test statistic).


**Stroke Hypothesis Tests:**

- We will assume the same assumptions and definition of the $\mu_{\text{female}}$ and $\mu_{\text{male}}$ parameters as the hypothesis above.

Model:

$X_i \sim F_1(\mu_{\text{female}}, \sigma_{\text{female}}), \quad i = 1, \ldots, n_1$    
$Y_i \sim F_2(\mu_{\text{male}}, \sigma_{\text{male}}), \quad i = 1, \ldots, n_2$   

Hypotheses:

$H_0: \mu_{\text{female}} = \mu_{\text{male}}$    
$H_a: \mu_{\text{female}} \neq \mu_{\text{male}}$

Test statistic

$t = \frac{\bar{x} - \bar{y}}{\text{SE}(\bar{x} - \bar{y})}$

```{r, warning = FALSE, echo = FALSE}

x = sex_data %>% filter(type == "Stroke" & sex == "Women") %>% pull(data)
y = sex_data %>% filter(type == "Stroke" & sex == "Men") %>% pull(data)
sex_stroke_test = t.test(x, y)
sex_stroke_test
```

There is not evidence to conclude that the mean mortality rate from stroke is different between men and women.(High p value, two-sided t-test, test statistic close to 0).

**Sex Influence on Heart Disease vs. Stroke:**

The difference in mortality rate per 100,000 population between the two deaths by age is shown through the graph. The average mortality is influenced more by sex for coronary heart disease compared to stroke deaths. Between sexes for stroke data, it has almost identical statistical data analysis while CHD differs in average, and upper and lower quantitles. 

```{r, warning = FALSE, echo = FALSE}
ggplot(sex_data, aes(y = data, x = type,  fill = sex)) +
  geom_boxplot()+
  ggtitle("CHD and Stroke Mortality by Sex Boxplot")+
  xlab("Cause of Death")+
  ylab("Mortality rate per 100,000")
```


### Race

Race may also have an influence on the mortality rate between coronoary heart disease and stroke. As asked in RQ1, we will test whether there is any difference between a specific race and the overall average of all. The data was filtered to obtain only the sex influenced rows^[```{r, warning = FALSE, echo = FALSE}
# race_data= data %>% 
#   filter(type != "Heart failure" & type != 	"Cardiovascular disease (CVD)" & type != "All heart disease", race != "Overall", sex == "Overall") %>% 
#   select(!sex)
# 
# race_sum = race_data %>% 
#   group_by(race, year, type) %>% 
#   mutate(c = n(),
#          n = c*100000,
#     total = sum(data),
#     mean = mean(data)) %>% 
#   distinct(total, c,n, mean) %>% 
#   mutate(p = total/n)
# race_sum
```], we conduct the following hypothesis test testing whether the average mortality rate are the same between races (male and female) or if they do not equal each other. The races given through the data set are: Black (Non-Hispanic), Hispanic, White, American Indian/Alaska Native and Asian/Pacific Islander. We test the hypothesis for each cause of death separately to control the influence on death.

```{r, include = FALSE, warning = FALSE, echo = FALSE}
race_data= data %>% 
  filter(type != "Heart failure" & type != 	"Cardiovascular disease (CVD)" & type != "All heart disease", race != "Overall", sex == "Overall") %>% 
  select(!sex)

race_sum = race_data %>% 
  group_by(race, year, type) %>% 
  mutate(c = n(),
         n = c*100000,
    total = sum(data),
    mean = mean(data)) %>% 
  distinct(total, c,n, mean) %>% 
  mutate(p = total/n)
race_sum
```

```{r, warning = FALSE, echo = FALSE}
mean= race_data %>% summarize(mean = mean(data)) %>% pull(mean)
ggplot(race_sum, aes(x = year, y = mean, color = type, scale= TRUE))+
  geom_point()+
  geom_smooth(se= FALSE)+
  facet_wrap(~race)+
  theme_bw()+
  geom_hline(yintercept =mean, linetype = "dashed", color = "red")+
  ggtitle("Scatter Plot of Mortality Rate by Race", subtitle = "grouped by Cardiovascular type")+
  ylab("Mortality Proportion of population")+
  xlab("Year")
```

**Coronary Heart Disease Hypothesis Tests:**

- We will assume that there is a universal parameters $\mu_{\text{all other}}$ and $\mu_{\text{black}}$ representing the mean mortality due to coronary heart disease per year over all races, sex, and age, and the mean mortality due to coronary heart disease of Asians/Pacific Islanders, respectively. 
- Assume that all trials are independent.

Model:

$X_i \sim F_1(\mu_{\text{all other}}, \sigma_{\text{all other}}), \quad i = 1, \ldots, n_1$    
$Y_i \sim F_2(\mu_{\text{black}}, \sigma_{\text{black}}), \quad i = 1, \ldots, n_2$   

Hypotheses:

$H_0: \mu_{\text{all other}} = \mu_{\text{black}}$    
$H_a: \mu_{\text{all other}} < \mu_{\text{black}}$

Test statistic:

$t = \frac{\bar{x} - \bar{y}}{\text{SE}(\bar{x} - \bar{y})}$

```{r, warning = FALSE, echo = FALSE}
x = race_data %>% filter(type == "CHD" & race != "Black (Non-Hispanic)") %>% pull(data)
y = race_data %>% filter(type == "CHD" & race == "Black (Non-Hispanic)") %>% pull(data)
race_chd_test = t.test(x, y, alternative = c("less"))
race_chd_test
```
	
There is strong statistically evidence that the mean mortality rate of Non-Hispanic Black people is disproportionately higher than the average of all other races. There is a difference between the groups, and we can see that by its low p value(p-value = 2.2e-16, two sided t-test) and extreme test statistic.


**Stroke Hypothesis Tests:**

- We will assume that there is a universal parameters $\mu_{\text{all other}}$ and $\mu_{\text{asian}}$ representing the mean mortality due to stroke per year over all races, sex, and age, and the mean mortality due to stroke of Blacks(non Hispanics), respectively. 
- Assume that all trials are independent.

Model:

$X_i \sim F_1(\mu_{\text{all other}}, \sigma_{\text{all other}}), \quad i = 1, \ldots, n_1$    
$Y_i \sim F_2(\mu_{\text{asian}}, \sigma_{\text{asian}}), \quad i = 1, \ldots, n_2$   

Hypotheses:

$H_0: \mu_{\text{all other}} = \mu_{\text{asian}}$    
$H_a: \mu_{\text{all other}} > \mu_{\text{asian}}$

Test statistic:

$t = \frac{\bar{x} - \bar{y}}{\text{SE}(\bar{x} - \bar{y})}$

```{r, warning = FALSE, echo = FALSE}

x = race_data %>% filter(type == "Stroke" & race != "Asian/Pacific Islander") %>% pull(data)
y = race_data %>% filter(type == "Stroke" & race == "Asian/Pacific Islander") %>% pull(data)
race_stroke_test = t.test(x, y, alternative = c("greater"))
race_stroke_test
```

There is strong evidence that the mean mortality rate of Asians is disproportionately lower than the average mortality rate of all other races. There is a difference between the groups, and we can see that by its low p value(p-value = 2.2e-16, two sided t-test) and extreme test statistic.


**Race Influence on Heart Disease vs. Stroke:**

Overall, there seems to be trend between the higher influence of race in those who suffered from CHD compared to those of stroke. This is demonstrated through the higher range quantities for CHD and the higher differences between each race. Stroke moralities are all under 1500 and have an average close to 115. 

```{r, warning = FALSE, echo = FALSE}
ggplot(race_data, aes(y = data, x = type,  fill = race)) +
  geom_boxplot()+
  ggtitle("CHD and Stroke by Race Boxplot")+
  xlab("Cause of Death") +
  ylab("Mortality rate per 100,000")
```

### Geography

... INCLUDE INTRO ...

```{r, warning = FALSE, echo = FALSE, warning = FALSE}
health_data = all_data%>%
  select("year" = Year, "state" = LocationAbbr, "desc" = LocationDesc, "topic" = Topic, age = Stratification1, race = Stratification2, sex = Stratification3, value = Data_Value, class = Class)

heart_data = health_data%>%
  filter(topic == "All heart disease")
stroke_data = health_data%>%
  filter(topic == "All stroke")
```

```{r, include = TRUE, echo = FALSE, warning = FALSE}
states = heart_data%>%select(state)%>%unique()%>%pull()
heart_neutral = heart_data%>%
  filter(age == "Ages 35-64 years" & race == "Overall" & sex == "Overall")
data_2019 = heart_neutral%>%
  filter(year == 2019)%>%
  select("state", "desc", "value")%>%unique()%>% drop_na() %>% group_by(state, desc) %>% summarize(value)
data_1999 = heart_neutral%>%
  filter(year == 1999)%>%
  select("state", "desc", "value")%>%unique()%>% drop_na() %>% group_by(state, desc) %>% summarize(value)
combined_year_data = data_1999%>%right_join(data_2019, by = "desc")%>%
  select(state = state.x, desc, val_2019 = value.y, val_1999 = value.x)%>%
  mutate(diff_20 = val_2019 - val_1999)
map_data_change = combined_year_data%>%
  select(state, diff_20)%>%
  group_by(state)%>%
  summarize(avg_change = mean(diff_20))
plot_usmap(data = map_data_change, values = "avg_change", regions = "states", include = states) + 
  scale_fill_viridis_c(
    name = "Average change per county from 1999 to 2019 in the incidence of heart issues", label = scales::comma
  ) + 
  theme(panel.background = element_rect(color = "black", fill = "lightblue"))  
```

```{r, include = TRUE, echo = FALSE, warning = FALSE}
states = stroke_data%>%select(state)%>%unique()%>%pull()
stroke_neutral = stroke_data%>%
  filter(age == "Ages 35-64 years" & race == "Overall" & sex == "Overall")
stroke_data_2019 = stroke_neutral%>%
  filter(year == 2019)%>%
  select("state", "desc", "value")%>%unique()%>% drop_na() %>% group_by(state, desc) %>% summarize(value)
stroke_data_1999 = stroke_neutral%>%
  filter(year == 1999)%>%
  select("state", "desc", "value")%>%unique()%>% drop_na() %>% group_by(state, desc) %>% summarize(value)
stroke_combined_year_data = stroke_data_1999%>%right_join(stroke_data_2019, by = "desc")%>%
  select(state = state.x, desc, val_2019 = value.y, val_1999 = value.x)%>%
  mutate(diff_20 = val_2019 - val_1999)
stroke_map_data_change = stroke_combined_year_data%>%
  select(state, diff_20)%>%
  group_by(state)%>%
  summarize(avg_change = mean(diff_20))
plot_usmap(data = stroke_map_data_change, values = "avg_change", regions = "states", include = states) + 
  scale_fill_viridis_c(
    name = "Average change per county from 1999 to 2019 in the incidence of stroke issues", label = scales::comma
  ) + 
  theme(panel.background = element_rect(color = "black", fill = "lightblue"))  
```

#INCLUDE TITLE^^



## Analysis Summary

*Nolan can you write analysis summary here*

Stroke Analysis:
```{r, echo = FALSE, warning = FALSE}
stroke_analysis = tibble("Characteristic" = c("Age", "Sex", "Race"), "Hypothesis Test" = c("H_a: mu{35-64} != mu{65+}", "H_a: mu{female} != mu{male}", "H_a: mu{all other} > mu{asian}"), "X Mean" = c(20.75, 178.93, 161.72), "Y Mean" = c( 791.88, 179.08, 112.43), "Test Statistic" = c( -293.92, -0.098, 27.92), "P-Value" = c(2.2e-16,0.92, 2.2e-16))
stroke_analysis
```

Coronary Heart Disease Analysis:
```{r, echo = FALSE, warning = FALSE}
chd_analysis = tibble("Characteristic" = c("Age", "Sex", "Race"), "Hypothesis Test" = c("H_a: mu{35-64} != mu{65+}", "H_a: mu{female} != mu{male}", "H_a: mu{all other} > mu{black}"), "X Mean" = c(77.73, 330.96, 335.37), "Y Mean" = c( 791.88, 556.32, 399.81), "Test Statistic" = c( -270.64, -57.121, -16.225), "P-Value" = c(2.2e-16,2.2e-16, 2.2e-16))
chd_analysis
```



# Discussion

```{r}
dis_data = data %>% 
  filter(type != "Heart failure" & type != 	"Cardiovascular disease (CVD)" & type != "All heart disease") %>% 
  group_by(year,type, sex, race) %>% 
  mutate(c = n(),
         n = c*100000,
    total = sum(data)) %>% 
  distinct(total, c, n) %>% 
  mutate(p = total/n)
dis_data
proportion_stroke = dis_data %>% 
  group_by(type) %>% 
  summarise(mean_p = mean(p)) 
proportion_stroke
```

Beside surveying the mean number of people getting CHD and stroke, we can have some more questions about what is exactly the proportion of getting these diseases. In the following observation, we surveyed whether Black (non-Hispanic) people have higher rate of getting CHD and stroke. The average proportion of getting CHD among sample population in recent decades is 0.0035 and the average proportion of getting Stroke is 0.00152. Use a hypothesis test to test if the average proportion of Black (Non-Hispanic) getting CHD and stroke among sample population in recent decades are equal to 0.0035 and 0.00152 respectively versus the alternative that they are different.

$$
H_0: p_{\text{disease of black}}  = p_{\text{disease of all}} \\
H_a: p_{\text{disease of black}}  > p_{\text{disease of all}}
$$

```{r}
bl_df = dis_data %>% 
  filter (race == "Black (Non-Hispanic)")
stroke_df =  bl_df %>% filter(type == "Stroke")
chd_df = bl_df %>% filter(type == "CHD")
x_stroke = stroke_df %>%  pull(p)
x_CHD = chd_df %>%  pull(p)
t.test(x_stroke)
t.test(x_CHD)
blackstroke_sum=  bl_df %>% 
  group_by(type) %>% 
  summarise(n = n(),
            xbar = mean(p),
            sd = sd(p),
            se = sd / sqrt(n))
blackstroke_sum
```
> We are 95% confident that the mean proportion of Black (Non-hispanic) people getting stroke would have been between 0.001851512 and 0.002258730.
> We are 95% confident that the mean proportion of Black (Non-hispanic) people getting CHD would have been between 0.003515034 and 0.004481209.
A plot representing the density of proportion of getting these diseases

```{r}
ggplot(stroke_df, aes(x = p))+
  geom_density(fill = 'Orange')+
  ggtitle("Density of the proportion of getting stroke of Black (Non-hispanic) people") +
  xlab("Proportion")+
  geom_hline(yintercept = 0)
ggplot(chd_df, aes(x = p))+
  geom_density(fill = 'Red') +
  ggtitle("Density of the proportion of getting CHD of Black (Non-hispanic) people")+
  xlab("Proportion")+
  geom_hline(yintercept = 0)
```

```{r}
mean0_p_stroke = 0.00152
mean0_p_chd = 0.0035
tstat_stroke  = blackstroke_sum %>% 
  filter (type == 'Stroke') %>% 
  mutate( tstat = (xbar -  mean0_p_stroke)/se,
          pval_stroke = 1- pt(tstat, n-1))
tstat_stroke
tstat_s = tstat_stroke$tstat
tstat_chd  = blackstroke_sum %>% 
  filter (type == 'CHD') %>% 
  mutate( tstat = (xbar -  mean0_p_chd)/se,
          pval_stroke = 1- pt(tstat, n-1))
tstat_chd
tstat_c = tstat_chd$tstat
```

```{r}
gt(df = 20)+
  geom_vline(xintercept = tstat_s, linetype = "dashed", colour = 'red') +
  geom_vline(xintercept = tstat_c, linetype = "dashed", colour = 'black')
```

> Conclusion: There is very strong evidence (p= 0.022, and p = 1.145968e-05, respectively, one-sided t-test) that the average proportion of Black (Non-hispanic) people has higher chance to get stroke and CHD than those of overall people, which is 0.00152 and 0.0035, respectively.
In addition, we have the similar questions around the data: whether Asian people have higher proportion of getting diseases than the average of the overall, how much are the proportions, whether they are consistent throughout the years, etc. However, our models might be based on fault assumptions:
- The data collected is biased, not random, so we cannot assume these data is random, and making models for the larger population.
- The data might not be continuous (There might not be possible the number of people getting disease).
- The distribution might not be approximately normal.

For further analyzing, we can dig deeper into factors affecting one group having higher average chance of getting disease (Stroke and CHD), making regression to predict the pattern of the average proportion of people getting disease in different regions , etc.

In conclusion, we divide our result into 3 categories including Age, Sex, and Race:
- Age: There is very strong evidence that the mean mortality rate of those aged 35 to 64 who died from coronary heart disease is different from the mean of the mortality rate of those aged 65 and older from heart disease ($p = 2.2e-16$, two-sided t-test, unequal variances). Also, there is very strong evidence that the mean mortality rate of those aged 35 to 64 who died from stroke is different from the mean of the mortality rate of those aged 65 and older from heart disease ($p = 2.2e-16$, two-sided t-test, unequal variances).
- Sex:
- Race:



# References



